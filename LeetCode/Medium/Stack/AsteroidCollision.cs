namespace LeetCode.Medium.Stack;

/// <summary>
/// 735. Asteroid Collision
/// Условие: астероиды движутся влево (отрицательные) или вправо (положительные).
/// При столкновении меньший взрывается, равные оба взрываются. Вернуть оставшиеся астероиды.
///
/// Подход (стек):
/// 1. Используем стек для хранения астероидов, движущихся вправо.
/// 2. Для каждого астероида:
///    - Если он движется вправо (положительный) → добавляем в стек.
///    - Если движется влево (отрицательный):
///      * Пока в стеке есть астероиды вправо и текущий больше по модулю → удаляем из стека.
///      * Если текущий равен по модулю → удаляем оба.
///      * Если текущий меньше по модулю → пропускаем текущий.
///
/// Сложность:
/// - Время: O(n) — каждый астероид обрабатывается один раз
/// - Память: O(n) — для стека в худшем случае
///
/// Пример 1:
/// Input: asteroids = [5,10,-5]
/// Output: [5,10]
/// Объяснение: 10 и -5 сталкиваются, -5 взрывается
///
/// Пример 2:
/// Input: asteroids = [8,-8]
/// Output: []
/// Объяснение: 8 и -8 сталкиваются, оба взрываются
///
/// Пример 3:
/// Input: asteroids = [10,2,-5]
/// Output: [10]
/// Объяснение: 2 и -5 сталкиваются, 2 взрывается. Затем 10 и -5 сталкиваются, -5 взрывается
/// </summary>
public class SolutionAsteroidCollision
{
    public int[] AsteroidCollision(int[] asteroids)
    {
        var st = new Stack<int>();

        foreach (var a in asteroids)
        {
            var curr = a;
            var alive = true;

            // Столкновения только при "вправо" (в стеке сверху) и "влево" (текущий)
            while (alive && st.Count > 0 && st.Peek() > 0 && curr < 0)
            {
                var top = st.Peek();
                var at = Math.Abs(top);
                var ac = Math.Abs(curr);

                if (at < ac)
                {
                    // верх стека меньше — он взрывается, продолжаем биться дальше
                    st.Pop();
                    continue;
                }
                else if (at == ac)
                {
                    // одинаковые — оба взрываются
                    st.Pop();
                    alive = false; // текущий тоже исчез
                }
                else
                {
                    // верх стека больше — текущий исчезает
                    alive = false;
                }
            }

            if (alive) st.Push(curr);
        }

        return st.Reverse().ToArray();
    }
}